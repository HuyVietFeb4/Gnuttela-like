syntax = "proto3";
package peer;

service PeerService {
    rpc Announce (PeerAddress) returns (PeerAddress) {}
    rpc ExitNetwork (PeerAddress) returns (Response) {}
    rpc PingBloom (BloomFilter) returns (Response) {}
    rpc QueryFile (Query) returns (QueryResult) {}
    rpc QuerySelf (Query) returns (QueryResult) {}
    rpc QueryEach (Query) returns (Files) {}
    rpc DownloadFile (FileName) returns (stream Chunk) {}
    rpc Bully (BullyRequest) returns (Response) {}
    rpc LeaderElection (PeerAddress) returns (Response) {}
}

message Response {
    string msg = 1;
}

message PeerAddress {
    string ip = 1;
    int32 port = 2;
}

message BloomFilter {
    PeerAddress address = 1;
    bytes bloom = 2;
}

message Query {
    string keyword = 1;
}

message QueryResult {
    bytes files = 1;
}

message Files {
    repeated string file_list = 1;
}

message FileName {
    string file = 1;
}

message Chunk {
    bytes buffer = 1;
}

message BullyRequest {
    PeerAddress peer = 1;
    bytes id = 2;
}